import{A as D}from"./add-cbad5679.js";import{d as I,c,r as w,o as M,a as n,b as d,e as t,w as _,v as p,u as e,f as m,F as E,g as P,t as g,h as v,i as G,j as z,k as H,l as J,p as K,m as Q,_ as L,n as V,q as W,s as X,B as Z}from"./index-e670b3a1.js";import{E as tt,g as et,a as st}from"./navigation-helpers-9634df95.js";import{u as ot,a as lt,O as i}from"./book-store-7d08f441.js";import{u as nt,T as at}from"./use-page-c1530ce8.js";import"./lodash-bf2fda92.js";const r=h=>(K("data-v-9b67dbac"),h=h(),Q(),h),it={class:"table table-striped align-middle text-center"},dt=r(()=>t("tr",{class:"title"},[t("th",{style:{width:"20%"}},"Authors"),t("th",{style:{width:"5%"}}),t("th",null,"Title"),t("th",{style:{width:"15%"}},"Year"),t("th",{style:{width:"15%"}},"Category"),t("th",{style:{width:"15%"}},"Price"),t("th")],-1)),rt={class:"filter"},ut=r(()=>t("th",null,null,-1)),ct=r(()=>t("th",null,null,-1)),_t=["disabled"],pt={class:"input-group"},mt=["disabled"],ht=r(()=>t("span",{class:"input-group-text"},"-",-1)),gt=["disabled"],vt=["disabled"],yt={class:"input-group"},ft=["disabled"],bt=r(()=>t("span",{class:"input-group-text"},"-",-1)),St=["disabled"],kt=r(()=>t("th",null,null,-1)),Ct={key:0},xt=r(()=>t("tr",null,[t("td",{colspan:"10"},"Loading...")],-1)),Bt=[xt],Ut={key:1},wt=r(()=>t("tr",null,[t("td",{colspan:"10"},"Something went wrong... Please come back later!")],-1)),Et=[wt],Pt={key:2},Vt=r(()=>t("tr",null,[t("td",{colspan:"10"},"No books found... Please add one!")],-1)),It=[Vt],Lt={key:3},Ft=r(()=>t("tr",null,[t("td",{colspan:"10"},"No books matching your filter... Please weaken your requirements!")],-1)),Nt=[Ft],Rt={key:4},$t={class:"author-list"},At=["textContent"],Ot=["src","alt","title"],Tt={class:"text-start"},Yt={class:"text-end"},jt={class:"d-flex gap-2"},qt=["onClick"],Dt=["onClick"],Mt=I({__name:"BookList",setup(h){const C=H(),x=J(),{getBooks:y,fetchBooks:F,getFetchStatus:N,removeBook:R}=ot(),{getAuthor:$}=lt(),a=c(N),l=w({}),A=c(()=>Object.values(l.value).some(Boolean)),B=c(y),f=c(()=>y(l.value)),O=c(()=>et(f.value,b.value,S.value)),T=c(()=>B.value.length===0),Y=c(()=>f.value.length===0),S=w(5),b=nt("books",()=>st(f.value.length,S.value)),j=U=>{const o=U.map($);if(o.length===0)return{[""]:"-"};if(o.length<3)return Object.fromEntries(o.map(u=>[u==null?void 0:u.id,u==null?void 0:u.name]));const[s]=o;return{[String(s==null?void 0:s.id)]:s==null?void 0:s.name,[""]:`and ${o.length-1} more`}};return M(F),(U,o)=>(n(),d("table",it,[t("thead",null,[dt,t("tr",rt,[ut,ct,t("th",null,[_(t("input",{class:"form-control","onUpdate:modelValue":o[0]||(o[0]=s=>l.value.title=s),disabled:e(a)!==e(i).SUCCESS},null,8,_t),[[p,l.value.title]])]),t("th",null,[t("div",pt,[_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>l.value.minYear=s),disabled:e(a)!==e(i).SUCCESS},null,8,mt),[[p,l.value.minYear]]),ht,_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>l.value.maxYear=s),disabled:e(a)!==e(i).SUCCESS},null,8,gt),[[p,l.value.maxYear]])])]),t("th",null,[_(t("input",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>l.value.category=s),disabled:e(a)!==e(i).SUCCESS},null,8,vt),[[p,l.value.category]])]),t("th",null,[t("div",yt,[_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=s=>l.value.minPrice=s),disabled:e(a)!==e(i).SUCCESS},null,8,ft),[[p,l.value.minPrice]]),bt,_(t("input",{type:"number",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>l.value.maxPrice=s),disabled:e(a)!==e(i).SUCCESS},null,8,St),[[p,l.value.maxPrice]])])]),kt])]),e(a)===e(i).PENDING?(n(),d("tbody",Ct,Bt)):m("",!0),e(a)===e(i).ERROR?(n(),d("tbody",Ut,Et)):m("",!0),e(a)===e(i).SUCCESS&&e(T)?(n(),d("tbody",Pt,It)):e(a)===e(i).SUCCESS&&e(Y)?(n(),d("tbody",Lt,Nt)):m("",!0),e(a)===e(i).SUCCESS?(n(),d("tbody",Rt,[(n(!0),d(E,null,P(e(O),s=>{var u;return n(),d("tr",{key:s.id},[t("td",null,[t("ul",$t,[(n(!0),d(E,null,P(j(s.authorIds),(k,q)=>(n(),d("li",{key:q,textContent:g(k)},null,8,At))),128))])]),t("td",null,[s.posterUrl?(n(),d("img",{key:0,src:s.posterUrl,alt:s.title,title:s.title,height:"60",width:"40",class:"poster"},null,8,Ot)):m("",!0)]),t("td",Tt,g(s.title),1),t("td",null,g(s.year??"-"),1),t("td",null,g(s.category??"-"),1),t("td",Yt,g(s.price?`${(u=s.price)==null?void 0:u.toFixed(2)} ₽`:"-"),1),t("td",null,[t("div",jt,[t("button",{type:"button",class:"btn btn-outline-secondary action",onClick:k=>e(C).push({name:"books-edit",params:{bookId:s.id},query:{redirect:e(x).fullPath}})},[v(e(tt))],8,qt),t("button",{type:"button",class:"btn btn-outline-danger action",onClick:k=>e(R)(s)}," × ",8,Dt)])])])}),128))])):m("",!0),e(a)===e(i).SUCCESS?(n(),G(at,{key:5,page:e(b),"onUpdate:page":o[6]||(o[6]=s=>z(b)?b.value=s:null),isFiltered:e(A),total:e(B).length,filtered:e(f).length,perPage:S.value},null,8,["page","isFiltered","total","filtered","perPage"])):m("",!0)]))}});const Gt=L(Mt,[["__scopeId","data-v-9b67dbac"]]),zt={class:"mb-3"},Ht={class:"mb-3 d-flex flex-wrap"},Jt=I({__name:"BookListView",setup(h){return(C,x)=>{const y=X("RouterLink");return n(),d("div",null,[t("h1",zt,[v(e(Z)),V(" Books ")]),t("div",Ht,[v(y,{to:{name:"books-add"},class:"btn btn-primary d-flex align-items-center gap-1"},{default:W(()=>[v(e(D)),V(" New Book ")]),_:1})]),v(Gt)])}}});const ee=L(Jt,[["__scopeId","data-v-e158fe4a"]]);export{ee as default};
