import{x as g,r as B}from"./index-e670b3a1.js";const N={GET_BOOKS:"https://www.googleapis.com/books/v1/volumes"},w=o=>{var k,p;const{id:s,volumeInfo:c,saleInfo:u}=o,{title:i,authors:n,publishedDate:a,description:d,industryIdentifiers:l,imageLinks:t,categories:e}=c,r=(n==null?void 0:n.map(y))??[],[m]=e??[];return{book:{id:s,isbn:(k=l==null?void 0:l.find(({type:v})=>v==="ISBN_13"))==null?void 0:k.identifier,year:Number.parseInt(a)||void 0,title:i,authorIds:r.map(({id:v})=>v),posterUrl:t.thumbnail,description:d,price:(p=u.retailPrice)==null?void 0:p.amount,category:m},authors:r}},y=o=>({id:o,name:o}),I=o=>{const s=new Map;for(const{authors:c}of o)for(const u of c)s.set(u.id,u);return s},R={async getBooks(o){const c=(await fetch(`${N.GET_BOOKS}?q=${encodeURIComponent(o)}`).then(i=>i.json())).items.map(w),u=I(c);return{books:c.map(({book:i})=>i).filter(Boolean),authors:Array.from(u.values())}}},x=g("author",()=>{const o=B([]);return{authors:o,getAuthors:n=>{if(!n)return o.value;const{name:a,country:d}=n,l=a==null?void 0:a.toLowerCase(),t=d==null?void 0:d.toLowerCase();return o.value.filter(e=>{var r;return(!l||e.name.toLowerCase().includes(l))&&(!t||((r=e.country)==null?void 0:r.toLowerCase().includes(t)))})},getAuthor:n=>o.value.find(a=>a.id===n),addAuthor:async n=>{o.value.push(n)},updateAuthor:async n=>{const a=o.value.findIndex(({id:d})=>d===n.id);a!==-1&&(o.value[a]=n)}}});var h=(o=>(o.NONE="NONE",o.SUCCESS="SUCCESS",o.ERROR="ERROR",o.PENDING="PENDING",o))(h||{});const b=g("book",()=>{const o=B(h.NONE),s=B([]),c=()=>o.value,u=t=>s.value.find(e=>e.id===t),i=async t=>{s.value.push(t)};return{books:s,getBook:u,addBook:i,updateBook:async t=>{const e=s.value.findIndex(({id:r})=>r===t.id);e!==-1&&(s.value[e]=t)},removeBook:async({id:t})=>{s.value=s.value.filter(e=>e.id!==t)},getBooks:t=>{if(!t)return s.value;const{title:e,minYear:r,maxYear:m,category:C,minPrice:k,maxPrice:p}=t,v=e==null?void 0:e.toLowerCase(),E=C==null?void 0:C.toLowerCase();return s.value.filter(f=>{var A,S;return(!v||((A=f.title)==null?void 0:A.toLowerCase().includes(v)))&&(!r||r<=f.year)&&(!m||f.year<=m)&&(!E||((S=f.category)==null?void 0:S.toLowerCase().includes(E)))&&(!k||k<=f.price)&&(!p||f.price<=p)})},getFetchStatus:c,fetchBooks:async()=>{if(![h.PENDING,h.SUCCESS].includes(o.value))try{o.value=h.PENDING;const{books:t,authors:e}=await R.getBooks("vue.js");t.forEach(i);const{addAuthor:r}=x();e.forEach(r),o.value=h.SUCCESS}catch(t){o.value=h.ERROR,console.error(t.stack)}}}});export{h as O,x as a,b as u};
